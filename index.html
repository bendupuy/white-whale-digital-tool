from pathlib import Path

# Load and modify the provided HTML file
input_path = Path("/mnt/data/index.html.txt")
output_path = Path("/mnt/data/index-updated.html")

# Read original HTML
html_content = input_path.read_text()

# Modify the script to integrate Formspree and update the CTA section
formspree_url = "https://formspree.io/f/mpwlqgko"

# Remove old mailto logic and inject new form-based POST submission
# Replace sendLeadData() content with fetch POST to Formspree
updated_script = f"""
        function sendLeadData() {{
            const serviceNames = {{
                'brand-audit': 'Brand Audit & Repositioning',
                'digital-strategy': 'Digital Marketing Strategy',
                'social-analysis': 'Social Media Analysis',
                'other': 'Other'
            }};

            const submission = {{
                name: responses.firstName + ' ' + responses.lastName,
                email: responses.email,
                lifecycle: responses.lifecycle,
                service: serviceNames[responses.service]
            }};

            fetch("{formspree_url}", {{
                method: "POST",
                headers: {{
                    "Content-Type": "application/json",
                    "Accept": "application/json"
                }},
                body: JSON.stringify(submission)
            }})
            .then(response => {{
                if (!response.ok) {{
                    console.error('Formspree error:', response.statusText);
                }}
            }})
            .catch(error => {{
                console.error('Submission failed:', error);
            }});
        }}
"""

html_content = html_content.replace(
    "function sendLeadData() {", updated_script.strip().split("\n")[0]
).replace(
    "        function sendLeadData() {", updated_script.strip()
)

# Replace the consultation button with final copy
old_cta_button_block = """<button class="btn" onclick="window.open('mailto:info@whitewhale.digital?subject=Marketing Strategy Consultation&body=Hi, I just completed your Market Life Cycle Assessment and would like to schedule a consultation. My name is ' + responses.firstName + ' ' + responses.lastName + ' and I\\'m interested in ' + responses.service + '.', '_blank')">Schedule Free Consultation</button>"""
new_cta_copy = """<p class="final-copy">
    Ready to dive deeper into your strategy? Email us at <a href="mailto:info@whitewhale.digital">info@whitewhale.digital</a>
</p>"""

html_content = html_content.replace(old_cta_button_block, new_cta_copy)

# Save the updated file
output_path.write_text(html_content)
output_path.name
